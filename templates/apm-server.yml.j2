name: '{{ elastic_apm_beat_name }}'

apm-server:
  host: '0.0.0.0:8200'
  {% if elastic_apm_secret_token is defined %}secret_token: {{ elastic_apm_secret_token }}{% endif%}

{% if elastic_apm_kibana_enabled %}
setup.kibana.host: '{{ elastic_apm_kibana_protocol }}://{% if elastic_apm_kibana_basic_auth_username %}{{ elastic_apm_kibana_basic_auth_username }}:{{ elastic_apm_kibana_basic_auth_password }}@{% endif %}{{ elastic_apm_kibana_host }}:{{ elastic_apm_kibana_port }}'
setup.kibana.protocol: '{{ elastic_apm_kibana_protocol }}'
setup.kibana.username: '{{ elastic_apm_kibana_basic_auth_username }}'
setup.kibana.password: '{{ elastic_apm_kibana_basic_auth_password }}'
setup.kibana.ssl.enabled: '{{ elastic_apm_kibana_protocol == "https" }}'
setup.dashboards.enabled: {{ elastic_apm_kibana_setup_dashboards }}
{% endif %}

setup.template.enabled: '{{ elastic_apm_setup_template_enabled }}'
setup.template.settings:
  index:
    number_of_shards: 1
    codec: best_compression

output.elasticsearch:
  hosts:
    {{ elastic_apm_elasticsearch_hosts | to_yaml | indent(4) }}
  compression_level: {{ elastic_apm_compression_level }}
  indices:
    - index: "apm-%{[beat.version]}-sourcemap"
      when.contains:
        processor.event: "sourcemap"

    - index: "apm-%{[beat.version]}-error-%{+yyyy.MM.dd}"
      when.contains:
        processor.event: "error"

    - index: "apm-%{[beat.version]}-transaction-%{+yyyy.MM.dd}"
      when.contains:
        processor.event: "transaction"

    - index: "apm-%{[beat.version]}-span-%{+yyyy.MM.dd}"
      when.contains:
        processor.event: "span"

    - index: "apm-%{[beat.version]}-metric-%{+yyyy.MM.dd}"
      when.contains:
        processor.event: "metric"

    - index: "apm-%{[beat.version]}-onboarding-%{+yyyy.MM.dd}"
      when.contains:
        processor.event: "onboarding"

xpack.monitoring:
  enabled: true
